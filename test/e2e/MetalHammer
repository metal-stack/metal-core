FROM golang:1.11-stretch as builder

WORKDIR /build
ENV CGO_ENABLED=0 \
    GO111MODULE=on \
    GOOS=linux \
    GOPROXY=https://gomods.fi-ts.io

# Install dependencies and Mage
COPY ./ ./
RUN go mod download \
 && go build -o metal-hammer

FROM ubuntu:18.04
LABEL maintainer FI-TS Devops <devops@f-i-ts.de>

RUN apt update \
 && apt install -y \
    openssh-server \
 && mkdir /bbin \
 && ln -s /usr/sbin/sshd /bbin/sshd

COPY --from=builder /build/metal-hammer /
